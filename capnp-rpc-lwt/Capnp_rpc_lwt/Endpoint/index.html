<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Endpoint (capnp-rpc-lwt.Capnp_rpc_lwt.Endpoint)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">capnp-rpc-lwt</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Capnp_rpc_lwt.Endpoint</span></h1></header><div class="doc"><p>Send and receive capnp messages over a byte-stream.</p></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>A wrapper for a byte-stream (flow).</p></div></div><div class="spec val" id="val-send"><a href="#val-send" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>send : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> Capnp.BytesMessage.Message.t <span class="keyword">&#8209;&gt;</span> (unit, [ `Closed | `Msg of string ]) Pervasives.result Lwt.t</code></div><div class="doc"><p><code class="code">send t msg</code> transmits <code class="code">msg</code>.</p></div></div><div class="spec val" id="val-recv"><a href="#val-recv" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>recv : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (Capnp.Message.ro Capnp.BytesMessage.Message.t, [&gt; `Closed ]) Pervasives.result Lwt.t</code></div><div class="doc"><p><code class="code">recv t</code> reads the next message from the remote peer.
It returns <code class="code">Error `Closed</code> if the connection to the peer is lost
(this will also happen if the switch is turned off).</p></div></div><div class="spec val" id="val-of_flow"><a href="#val-of_flow" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_flow : switch:Lwt_switch.t <span class="keyword">&#8209;&gt;</span> (<span class="keyword">module </span>Mirage_flow_lwt.S <span class="keyword">with</span> <span class="keyword">type </span>flow <span class="keyword">=</span> <span class="type-var">'flow</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'flow</span> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">of_flow ~switch (module F) flow</code> sends and receives on <code class="code">flow</code>.
The caller should arrange for <code class="code">flow</code> to be closed when the switch is turned off.
If the flow is closed, the switch will be turned off.
If the flow returns an error when the switch is off, the endpoint will return <code class="code">`Closed</code>
instead of the underlying error.</p></div></div><div class="spec val" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_error : [&lt; `Closed | `Msg of string ] Fmt.t</code></div><div class="doc"></div></div></body></html>